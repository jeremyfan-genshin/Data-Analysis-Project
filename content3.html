<!DOCTYPE html>
<html lang="zh-Hant">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>æ‰¹æ¬¡å¯«å…¥å¾Œç¢ºèªè³‡æ–™æ˜¯å¦æˆåŠŸ</title>
    <style>
        body {
            font-family: "Microsoft JhengHei", "Noto Sans TC", sans-serif;
            line-height: 1.6;
            margin: 20px;
            background: #fefefe;
            color: #333;
        }

        h1 {
            font-size: 1.8rem;
            margin-bottom: 1rem;
            border-bottom: 2px solid #4caf50;
            padding-bottom: 0.3rem;
            color: #2e7d32;
        }

        h2 {
            color: #388e3c;
            margin-top: 1.4rem;
            margin-bottom: 0.6rem;
        }

        p {
            margin-bottom: 1rem;
        }

        ul {
            list-style: none;
            padding-left: 1rem;
            margin-bottom: 1rem;
        }

        ul li::before {
            content: "âœ… ";
            color: green;
        }

        pre {
            background: #f4f4f4;
            padding: 12px;
            border-radius: 6px;
            overflow-x: auto;
            white-space: pre-wrap;
            word-break: break-word;
            font-family: Consolas, monospace;
            font-size: 0.95rem;
            margin: 1rem 0;
        }

        table {
            border-collapse: collapse;
            width: 100%;
            max-width: 600px;
            margin-top: 1rem;
        }

        th,
        td {
            border: 1px solid #bbb;
            padding: 8px 12px;
            text-align: left;
        }

        th {
            background-color: #c8e6c9;
        }

        .emoji {
            font-weight: bold;
            font-size: 1.2rem;
            margin-right: 0.3rem;
        }
    </style>
</head>

<body>

    <h1>æ‰¹æ¬¡å¯«å…¥å¾Œç¢ºèªã€Œè³‡æ–™æ˜¯å¦å¯«å…¥æˆåŠŸã€æ–¹æ³•</h1>

    <p>æ‰¹æ¬¡å¯«å…¥å¾Œç¢ºèªã€Œè³‡æ–™æ˜¯å¦å¯«å…¥æˆåŠŸã€æ˜¯å¾ˆé—œéµçš„ä¸€æ­¥ã€‚ä»¥ä¸‹æ˜¯å¯¦å‹™ä¸Šå¸¸ç”¨çš„æ–¹æ³•ï¼Œä¾ä½ ä½¿ç”¨çš„è³‡æ–™åº«èˆ‡å¯«å…¥å·¥å…·ç•¥æœ‰ä¸åŒï¼Œä½†æ•´é«”é‚è¼¯éƒ½ç›¸é€šã€‚</p>

    <h2><span class="emoji">âœ…</span>å¸¸è¦‹æ–¹å¼ä¸€ï¼šæª¢æŸ¥è³‡æ–™åº«å›å‚³çš„çµæœ or ä¾‹å¤–éŒ¯èª¤</h2>
    <p>1. ä½¿ç”¨ <code>executemany()</code> æ™‚ï¼Œè‹¥å¯«å…¥æˆåŠŸï¼Œé€šå¸¸ï¼š</p>
    <ul>
        <li>ä¸æœƒä¸Ÿå‡ºä¾‹å¤–ï¼›</li>
        <li>ä½ å¯ä»¥æŸ¥çœ‹ <code>cursor.rowcount</code> è¡¨ç¤ºå—å½±éŸ¿çš„ç­†æ•¸ã€‚</li>
    </ul>
    <p>SQLite / MySQL ç¯„ä¾‹ï¼š</p>
    <pre>
cursor.executemany("INSERT INTO users (name, age) VALUES (?, ?)", data_batch)

print(f"{cursor.rowcount} rows inserted.")  # æ‡‰è©²ç­‰æ–¼ len(data_batch)
conn.commit()
</pre>
    <p>è‹¥ <code>rowcount</code> å°æ–¼é æœŸï¼Œä»£è¡¨æœ‰ç­†æ•¸å¯èƒ½æ²’æˆåŠŸå¯«å…¥ã€‚</p>

    <h2><span class="emoji">âœ…</span>å¸¸è¦‹æ–¹å¼äºŒï¼šæŸ¥è©¢è³‡æ–™æ˜¯å¦å·²å­˜åœ¨</h2>
    <p>ç”¨ä¸»éµã€å”¯ä¸€å€¼ç­‰æ¢ä»¶ä¾†ç¢ºèªè³‡æ–™çœŸçš„é€²å…¥è³‡æ–™åº«ï¼Œä¾‹å¦‚ï¼š</p>
    <pre>
cursor.execute("SELECT COUNT(*) FROM users WHERE name IN ('Alice', 'Bob', 'Charlie')")
count = cursor.fetchone()[0]
print(f"ç¢ºèªå¯«å…¥æˆåŠŸç­†æ•¸: {count}")
</pre>

    <h2><span class="emoji">âœ…</span>å¸¸è¦‹æ–¹å¼ä¸‰ï¼šä½¿ç”¨äº¤æ˜“ï¼ˆtransactionï¼‰æ©Ÿåˆ¶ä¿éšœä¸€è‡´æ€§</h2>
    <p>Python DB æ“ä½œåŸºæœ¬éƒ½æ”¯æ´äº¤æ˜“ï¼š</p>
    <pre>
try:
    cursor.executemany(sql, data_batch)
    conn.commit()  # ä¸€æ¬¡æäº¤ï¼Œæ²’éŒ¯æ‰å¯«å…¥
except Exception as e:
    conn.rollback()  # ç™¼ç”ŸéŒ¯èª¤å…¨éƒ¨å›å¾©
    print("å¯«å…¥å¤±æ•—ï¼Œå·²å›å¾©:", e)
</pre>
    <p>é€™æ¨£èƒ½ä¿è­‰ã€Œè¦å˜›å…¨éƒ¨æˆåŠŸã€è¦å˜›å…¨éƒ¨å¤±æ•—ã€ï¼Œé˜²æ­¢å¯«ä¸€åŠçš„ç‹€æ³ã€‚</p>

    <h2><span class="emoji">âœ…</span>å¸¸è¦‹æ–¹å¼å››ï¼šå¯«å…¥å¾Œè®€å›ç¢ºèªï¼ˆå°é‡è¦è³‡æ–™ï¼‰</h2>
    <p>å¦‚æœå¯«å…¥çš„æ˜¯é‡è¦è³‡æ–™ï¼Œé™¤äº†æª¢æŸ¥ç­†æ•¸å¤–ï¼Œä¹Ÿå¯ä»¥ã€Œè®€å‡ºå‰›å¯«å…¥çš„å…§å®¹ã€ä¾†åšé©—è­‰ï¼Œä¾‹å¦‚ï¼š</p>
    <pre>
cursor.execute("SELECT * FROM users ORDER BY id DESC LIMIT 3")
for row in cursor.fetchall():
    print(row)
</pre>

    <h2><span class="emoji">âœ…</span>è‹¥ä½¿ç”¨ pandas.to_sql()ï¼Œå¦‚ä½•ç¢ºèªï¼Ÿ</h2>
    <pre>
df.to_sql('users', con=engine, if_exists='append', index=False)

# å¯«å…¥å¾Œå†æ¬¡æŸ¥è©¢è¡Œæ•¸æˆ–ç‰¹å®šå€¼
with engine.connect() as conn:
    result = conn.execute("SELECT COUNT(*) FROM users")
    print(f"Total rows: {result.scalar()}")
</pre>

    <h2><span class="emoji">âœ…</span>è£œå……ï¼šå¯«å…¥æ—¥èªŒ / Log æ˜¯å¥½ç¿’æ…£</h2>
    <p>ä½ å¯ä»¥åœ¨æ¯æ¬¡æ‰¹æ¬¡å¯«å…¥æ™‚è¨˜éŒ„ï¼š</p>
    <pre>
print(f"[{datetime.now()}] å¯«å…¥ {len(batch)} ç­†è³‡æ–™æˆåŠŸ")
</pre>
    <p>æˆ–å¯«å…¥ä¸€å€‹ log æª”æ¡ˆä¸­ï¼Œæ–¹ä¾¿æ—¥å¾Œè¿½è¹¤ã€‚</p>

    <h2><span class="emoji">ğŸ”’</span>å°çµ â€” å¦‚ä½•ç¢ºèªæ‰¹æ¬¡å¯«å…¥æˆåŠŸï¼Ÿ</h2>
    <table>
        <thead>
            <tr>
                <th>æ–¹æ³•</th>
                <th>èªªæ˜</th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td><code>cursor.rowcount</code></td>
                <td>æŸ¥çœ‹æˆåŠŸå½±éŸ¿ç­†æ•¸</td>
            </tr>
            <tr>
                <td>æŸ¥è©¢å¯«å…¥çµæœ</td>
                <td>ç”¨ SELECT é©—è­‰æ˜¯å¦çœŸçš„å¯«å…¥</td>
            </tr>
            <tr>
                <td>try/except + commit</td>
                <td>ç™¼ç”ŸéŒ¯èª¤å°± rollbackï¼Œä¿è­‰ä¸€è‡´æ€§</td>
            </tr>
            <tr>
                <td>äº¤æ˜“æ§åˆ¶ï¼ˆtransactionï¼‰</td>
                <td>ç¢ºä¿æ‰¹æ¬¡å¯«å…¥çš„åŸå­æ€§</td>
            </tr>
            <tr>
                <td>æ—¥èªŒæˆ– log ç´€éŒ„</td>
                <td>ä¿ç•™ç´€éŒ„ï¼Œæ–¹ä¾¿é™¤éŒ¯</td>
            </tr>
        </tbody>
    </table>

</body>

</html>